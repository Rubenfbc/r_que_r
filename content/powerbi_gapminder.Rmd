---
title: "Utilizando R en Power Bi"
author: "Rubén F. Bustillo"
date: 2020-02-22
categories: ["R", "Power Bi"]
tags: ["R", "Power Bi", "Gapminder"]

---


```{r setup, include=FALSE}

knitr::opts_chunk$set(collapse = TRUE)

```

**Re**

Power Bi es una herramienta de Business Inteligence (BI) de Microsoft. Un aspecto interesante es que Power Bi permite fácilmente utilizar el lenguaje de R en diversas fases del proceso de análisis.

\

# Power Bi

\

[Power Bi](https://powerbi.microsoft.com/es-es/) es un recientemente nuevo servicio de Business Inteligence (BI) y análisis empresarial desarrollado por Microsoft. Esta herramienta, o conjunto de herramientas, se presenta como una solución integrada en Office 365, y permite la descarga de datos, o conexión a numerosas fuentes y orígenes de datos, la manipulación (limpieza y transformación), visualización y análisis de una forma bastante intuitiva, especialmente si tenemos conocimientos previos de Excel, tablas dinámicas, Power Pivot y Power Query. Power Bi permite la creación de paneles e informes personalizados y dinámicos, y su posterior publicación. Power Bi pretende con ello ser una herramienta que permita tener de forma sencilla una visión general del conjunto de la empresa mediante un análisis inteligente y una monitorización del funcionamiento conjunto del negocio ayudando con ello a tomar las mejores decisiones empresariales. Para el uso de Power Bi existen diversas opciones: Microsoft Desktop, Pro y Premium. La primera de ellas es de uso gratuito, aunque presenta limitaciones de funcionalidad con respecto a las otras dos versiones, especialmente en la fase de publicación de paneles e informes y a la hora de compartir los resultados con otros usuarios. Por su parte, las versiones de pago requieren licencias, y evidentemente su mayor o menor utilidad dependerá de las necesidades de la empresa o del usuario. 

\

Pero vayamos a lo que nos ocupa en este post. Resulta que, de una forma desde mi punto de vista muy interesante, Power Bi ha posibilitado diversos cauces mediante los cuales resulta posible integrar las capacidades de esta nueva plataforma con el lenguaje de R (y también de Phyton). Además, estos cauces son varios, siendo posible hacer uso de un R script para visualizar datos, pero también para la importación de los mismos o para su transformación y manipulación. Por consiguiente, el objetivo de este post será mostrar, utilizando los datasets del paquete {gapminder}, cómo realizar operaciones utilizando R en Power Bi. Los datasets escogidos, que personalmente me gustan mucho y los he utilizado en post previos (vease [este](https://rquer.netlify.com/joins_sql/) y [este](https://rquer.netlify.com/evolution/)) muestra, entre otros aspectos, la renta per cápita, la población y la esperanza de vida para 187 países en diversos años (1952-2006).  

\

Antes de empezar es importante tener presente que para trabajar con R en Power Bi es necesario tener instalado R en el mismo ordenador donde se tiene instalado Power Bi Desktop. De hecho, antes de utilizar algún paquete de R en Power Bi, resulta necesario tener ese paquete instalado previamente en R. En el menú de opciones de Power Bi Desktop podemos encontrar las opciones de *Script de R*, donde veremos que automáticamente se habrá detectado el directorio de inicio de R y, en el caso de usar un IDE (integrated development environment), como es mi caso que uso R Studio, Power Bi lo identificará también. 

\

Una vez dicho esto veamos cómo podemos utilizar R en Power Bi. Como he señalado, podemos utilizar R en diversas fases del proceso de análisis:

\

# 1. Importación de datos

\

Para utilizar R a la hora de importar datos en Power Bi debemos, una vez abierta una sesión en Power Desktop, ir a la pestaña que indica **obtener datos** situada en la barra superior y, posteriormente, seleccionar la opción **Script de R**. 

```{r, echo=FALSE, out.width = '100%'}

library(png)
library(grid)

importacion_1 <- readPNG("C:\\Users\\Usuario\\Desktop\\r_que_r\\r_que_r\\content\\pics\\r_y_powerbi_1.png")
grid.raster(importacion_1)

```

A continuación se abrirá una ventana donde podemos insertar un **Script de R**. Nosotros, como hemos indicado previamente, vamos a trabajar con los datasets del paquete {gapminder}. Descargaremos, por tanto, los datasets `gapminder`, `gapminder_unfiltered` y `country_codes`, utilizando el lenguaje tradicional de R. Recordemos que el paquete {gapminder} deberá estar previamente instalado en R.

```{r, echo=FALSE, out.width = '100%'}

importacion_2 <- readPNG("C:\\Users\\Usuario\\Desktop\\r_que_r\\r_que_r\\content\\pics\\r_y_powerbi_2.png")
grid.raster(importacion_2)

```

Si todo ha ido bien debería abrirse una nueva ventana donde nos permita seleccionar las tres tablas. Podemos seleccionar alguna de ellas, o las tres a la vez y cargarlas. En el caso de requerir alguna modificación, o para su visualización, podríamos indicar **transformar datos** y se abrirá el **editor de Power Query** que quizá conocemos al trabajar con Excel. 

```{r, echo=FALSE, out.width = '100%'}

importacion_3 <- readPNG("C:\\Users\\Usuario\\Desktop\\r_que_r\\r_que_r\\content\\pics\\r_y_powerbi_3.png")
grid.raster(importacion_3)

```

En esta ocasión indicamos **cargar**, en la parte inferior de la pantalla, y las tres tablas se cargarán en nuestro Power Bi Desktop. Los campos aparecerán en la parte derecha tal y como refleja la figura siguiente, pudiendo observar fácilmente el nombre de las columnas que componen cada una de las tablas. Por su parte, en la parte izquierda de la pantalla encontramos tres iconos. El superior, donde nos encontramos, sería la pantalla de **informe**, donde desarrollaremos el análisis y prepararemos el informe y sus visualizaciones, el siguiente icono abre la pantalla **datos**, que nos lleva al editor de Power Query y, por último, el tercer icono nos conduce a la pantalla del modelo donde podemos crear las relaciones entre tablas. 

```{r, echo=FALSE, out.width = '100%'}

importacion_4 <- readPNG("C:\\Users\\Usuario\\Desktop\\r_que_r\\r_que_r\\content\\pics\\r_y_powerbi_4.png")
grid.raster(importacion_4)

```

Si accedemos a la **pantalla del modelo**, podemos comprobar que Power Bi ha realizado automáticamente las relaciones entre las tablas vinculando las tablas `gapminder` y `gapminder_unfiltered` con la tabla `country_codes` usando como nexo de unión el nombre de los países (country). Aunque en este caso particular las relaciones han sido identificadas automáticamente por Power Bi, lo normal será que seamos nosotros los que tengamos que identificar de forma manual las relaciones correspondientes entre las distintas tablas que conforman nuestro modelo. 

```{r, echo=FALSE, out.width = '100%'}

importacion_5 <- readPNG("C:\\Users\\Usuario\\Desktop\\r_que_r\\r_que_r\\content\\pics\\r_y_powerbi_5.png")
grid.raster(importacion_5)

```

Una vez importadas las tablas podemos trabajar con ellas. A modo de ejemplo rápido pongamos que queremos realizar un **gráfico de barras** donde se indique la renta per cápita de los países incluidos en la tabla `gapminder` pero indicando en el eje los códigos iso (de la  tabla `country_codes`) para cada uno de los países en lugar del nombre del país. Esto implica utilizar información de las dos tablas conjuntamente gracias a las relaciones realizadas automáticamente por Power Bi. Utilizaremos además un filtro para poder seleccionar el año y clasificaremos los países por colores según el continente al que pertenecen. Estas operaciones se realizan de una forma muy sencilla en Power Bi Desktop indicando las operaciones correspondientes en el menú y arrastrando los valores que queremos incluir en el informe.   


```{r, echo=FALSE, out.width = '100%'}

importacion_6 <- readPNG("C:\\Users\\Usuario\\Desktop\\r_que_r\\r_que_r\\content\\pics\\r_y_powerbi_6.png")
grid.raster(importacion_6)

```


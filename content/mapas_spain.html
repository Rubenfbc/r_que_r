---
title: "¿Cómo realizar mapas de España con archivos shapefile?"
author: "Rubén F. Bustillo"
date: '2019-11-08'
tags: ["maps" ,"mapas", "Spain", "España", "Comunidades Autónomas","Provincias","Municipios","ggplot2", "shapefiles"]
categories: ["R"]
---



<p><strong>Re</strong></p>
<p>En este post se expondrá cómo realizar mapas de España utilizando archivos shapefile y el paquete ggplot2. Los archivos shapefiles los descargaremos de la web y los datos los descargaremos del INE.</p>
<p><br />
</p>
<div id="paquetes-de-r" class="section level2">
<h2>Paquetes de R</h2>
<pre class="r"><code>
# para manipular dataframes
library(tidyverse)

# para importar archivos shapefiles
library(rgdal)

# Para transformar los archivos shapefiles 
library(broom)</code></pre>
<p><br />
</p>
</div>
<div id="comunidades-autónomas-españolas" class="section level1">
<h1>Comunidades Autónomas Españolas</h1>
<p><br />
</p>
<p>En primer lugar vamos a exponer cómo realizar un mapa de España diferenciando las distintas <strong>Comunidades Autónomas</strong> que la componen. Para ello descargamos el archivo shapefile con la información geográfica de las autonomías españolas de <a href="https://www.arcgis.com/home/item.html?id=5f689357238847bc823a2fb164544a77">arcgis.com</a>. Nótese que un archivo shapefile (SHP) es un formato de datos espaciales de representación vectorial desarrollado por la compañía ESRI que sirve para almacenar información de la ubicación de distintas entidades geográficas. Dicha información geométrica se puede representar con puntos, líneas o polígonos (áreas).</p>
<p><br />
</p>
<p>La función <code>readOGR()</code>del paquete <code>rgdal</code> permite leer archivos shapefile (.shp) que en nuestro caso hemos descargado previamente desde la página mencionada y guardado en una carpeta de nuestro ordenador. Por su parte, con la función <code>tidy()</code> del paquete <code>broom</code> creamos un dataframe (data_ccaa) que nos servirá para su representación gráfica posterior.</p>
<p><br />
</p>
<div id="descarga-y-formato-de-archivos-shapefile" class="section level2">
<h2>Descarga y formato de archivos shapefile</h2>
<pre class="r"><code>
setwd(&quot;C:/Users/Usuario/Desktop/r_que_r/r_que_r/content/datasets/ComunidadesAutonomas_ETRS89_30N&quot;)


# Guardamos el archivo shapefile

shapefile_ccaa &lt;- readOGR(&quot;Comunidades_Autonomas_ETRS89_30N.shp&quot;)
## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\Usuario\Desktop\r_que_r\r_que_r\content\datasets\ComunidadesAutonomas_ETRS89_30N\Comunidades_Autonomas_ETRS89_30N.shp&quot;, layer: &quot;Comunidades_Autonomas_ETRS89_30N&quot;
## with 19 features
## It has 3 fields

# Para convertir el archivo shapefile en un dataframe utilizamos la función tidy()

data_ccaa &lt;- tidy(shapefile_ccaa)

# primeras observaciones del dataset

head(data_ccaa)
## # A tibble: 6 x 7
##      long      lat order hole  piece group id   
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 323065. 4288359.     1 FALSE 1     0.1   0    
## 2 323295. 4288263.     2 FALSE 1     0.1   0    
## 3 323997. 4288366.     3 FALSE 1     0.1   0    
## 4 324629. 4287514.     4 FALSE 1     0.1   0    
## 5 325061. 4287374.     5 FALSE 1     0.1   0    
## 6 325720. 4286706.     6 FALSE 1     0.1   0</code></pre>
<p><br />
</p>
<p>Vemos que el dataframe creado no contiene los nombres de las distintas CCAA españolas pero, en cambio, dicho dataframe indica el “id” de las mismas. No obstante, el archivo shapefile original si contiene información de los nombres de las Comunidades Autónomas. Por tanto, podemos extraer los nombres en un nuevo dataframe (nombres_ccaa) y añadir el “id” de cada una de las regiones. El objetivo es, posteriormente, unir los dos dataframes por la columna común “id”.</p>
<p><br />
</p>
<pre class="r"><code>
nombres_ccaa &lt;- data.frame(shapefile_ccaa$Texto)

head(nombres_ccaa)
##     shapefile_ccaa.Texto
## 1             AndalucÃ­a
## 2                AragÃ³n
## 3 Principado de Asturias
## 4         Islas Baleares
## 5               Canarias
## 6              Cantabria

nombres_ccaa$id &lt;- as.character(seq(0, nrow(nombres_ccaa)-1))

head(nombres_ccaa)
##     shapefile_ccaa.Texto id
## 1             AndalucÃ­a  0
## 2                AragÃ³n  1
## 3 Principado de Asturias  2
## 4         Islas Baleares  3
## 5               Canarias  4
## 6              Cantabria  5</code></pre>
<p><br />
</p>
<pre class="r"><code>
data_ccaa_mapa &lt;- left_join(data_ccaa, nombres_ccaa, by = &quot;id&quot;)

head(data_ccaa_mapa)
## # A tibble: 6 x 8
##      long      lat order hole  piece group id    shapefile_ccaa.Texto
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;               
## 1 323065. 4288359.     1 FALSE 1     0.1   0     AndalucÃ­a           
## 2 323295. 4288263.     2 FALSE 1     0.1   0     AndalucÃ­a           
## 3 323997. 4288366.     3 FALSE 1     0.1   0     AndalucÃ­a           
## 4 324629. 4287514.     4 FALSE 1     0.1   0     AndalucÃ­a           
## 5 325061. 4287374.     5 FALSE 1     0.1   0     AndalucÃ­a           
## 6 325720. 4286706.     6 FALSE 1     0.1   0     AndalucÃ­a</code></pre>
<p><br />
</p>
</div>
<div id="mapa-de-las-comunidades-autónomas-usando-ggplot" class="section level2">
<h2>Mapa de las Comunidades Autónomas usando ggplot</h2>
<p>Para representar en un mapa utilizando la información del dataframe obtenido del archivo shapefile podemos utilizar el paquete ggplot2 y la función <code>geom_polygon()</code>. De esta forma, utilizando las funciones de este paquete, podemos customizar el gráfico y modificar sus características.</p>
<p><br />
</p>
<pre class="r"><code>
data_ccaa_mapa %&gt;%
  ggplot() +
  geom_polygon(aes( x= long, y = lat, group = group),
               fill = &quot;violetred4&quot;,
               color = &quot;white&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    panel.background = element_rect(colour= &quot;darkgrey&quot;, size= 0.5)) +
  ggtitle(&quot;Comunidades Autónomas Españolas&quot;)</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
</div>
</div>
<div id="provincias-españolas" class="section level1">
<h1>Provincias Españolas</h1>
<p><br />
</p>
<p>En este subapartado vamos a realizar el mismo análisis realizado previamente pero identificando en esta ocasión <strong>las provincias españolas</strong>. Para ello, al igual que hicimos en el ejercicio anterior descargamos el archivo shapefile de <a href="https://www.arcgis.com/home/item.html?id=83d81d9336c745fd839465beab885ab7">arcgis.com</a>.</p>
<p><br />
</p>
<div id="descarga-y-formato-de-archivos-shapefile-1" class="section level2">
<h2>Descarga y formato de archivos shapefile</h2>
<pre class="r"><code>
setwd(&quot;C:/Users/Usuario/Desktop/r_que_r/r_que_r/content/datasets/Provincias_ETRS89_30N&quot;)


# Guardamos el archivo shapefile

shapefile_provincias &lt;- readOGR(&quot;Provincias_ETRS89_30N.shp&quot;)
## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\Usuario\Desktop\r_que_r\r_que_r\content\datasets\Provincias_ETRS89_30N\Provincias_ETRS89_30N.shp&quot;, layer: &quot;Provincias_ETRS89_30N&quot;
## with 52 features
## It has 5 fields

# Para convertir el archivo shapefile en un dataframe utilizamos la función tidy()

data_provincias &lt;- tidy(shapefile_provincias)

# primeras observaciones del dataset

head(data_provincias)
## # A tibble: 6 x 7
##      long      lat order hole  piece group id   
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 497824. 4784874.     1 FALSE 1     0.1   0    
## 2 498457. 4784220.     2 FALSE 1     0.1   0    
## 3 498532. 4783866.     3 FALSE 1     0.1   0    
## 4 498382. 4783793.     4 FALSE 1     0.1   0    
## 5 498946. 4783509.     5 FALSE 1     0.1   0    
## 6 499046. 4782937.     6 FALSE 1     0.1   0</code></pre>
<p><br />
</p>
<p>De nuevo vemos que el dataset creado contiene información del “id” pero no los nombres de las distintas provincias españolas. Obtenemos de nuevo los nombres del archivo shapefile original y realizamos el mismo ejercicio del punto anterior para obtener en nuestro dataframe una columna para el “id” y otra con el nombre de cada provincia española junto a la información de cada provincia para su representación gráfica.</p>
<p><br />
</p>
<pre class="r"><code>
nombres_provincias &lt;- data.frame(shapefile_provincias$Texto)

head(nombres_provincias)
##   shapefile_provincias.Texto
## 1                     Ã\201lava
## 2                   Albacete
## 3                   Alicante
## 4                   AlmerÃ­a
## 5                     Ã\201vila
## 6                    Badajoz

nombres_provincias$id &lt;- as.character(seq(0, nrow(nombres_provincias)-1))

head(nombres_provincias)
##   shapefile_provincias.Texto id
## 1                     Ã\201lava  0
## 2                   Albacete  1
## 3                   Alicante  2
## 4                   AlmerÃ­a  3
## 5                     Ã\201vila  4
## 6                    Badajoz  5</code></pre>
<p><br />
</p>
<pre class="r"><code>
data_provincias_mapa &lt;- left_join(data_provincias, nombres_provincias, by = &quot;id&quot;)

head(data_provincias_mapa)
## # A tibble: 6 x 8
##      long      lat order hole  piece group id    shapefile_provincias.Texto
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;                     
## 1 497824. 4784874.     1 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;             
## 2 498457. 4784220.     2 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;             
## 3 498532. 4783866.     3 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;             
## 4 498382. 4783793.     4 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;             
## 5 498946. 4783509.     5 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;             
## 6 499046. 4782937.     6 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;</code></pre>
<p><br />
</p>
</div>
<div id="mapa-de-las-provincias-usando-ggplot" class="section level2">
<h2>Mapa de las Provincias usando ggplot</h2>
<p>Utilizamos el mismo código para realizar un mapa similar al anterior pero, en este caso, identificando las <strong>provincias españolas</strong>.</p>
<p><br />
</p>
<pre class="r"><code>
data_provincias_mapa %&gt;%
  ggplot() +
  geom_polygon(aes( x= long, y = lat, group = group),
               fill = &quot;violetred4&quot;,
               color = &quot;white&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    panel.background = element_rect(colour= &quot;darkgrey&quot;, size= 0.5)) +
  ggtitle(&quot;Provincias Españolas&quot;)</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="municipios-españoles" class="section level1">
<h1>Municipios Españoles</h1>
<p><br />
</p>
<p>Por último realizamos un mapa donde se representen los distintos <strong>municipios de España</strong>. En este caso el archivo shapefile con información geográfica de los municipios españoles lo descargamos de <a href="https://opendata.esri.es/datasets/53229f5912e04f1ba6dddb70a5abeb72_0">opendata.esri.es</a>. La operativa es similar a la realizada en el punto anterior aunque en lugar de utilizar los nombres de los municipios <strong>utilizaremos los códigos provistos por el INE</strong> (CODIGOINE).</p>
<p><br />
</p>
<div id="descarga-y-formato-de-archivos-shapefile-2" class="section level2">
<h2>Descarga y formato de archivos shapefile</h2>
<pre class="r"><code>
setwd(&quot;C:/Users/Usuario/Desktop/r_que_r/r_que_r/content/datasets/Municipios_IGN&quot;)

# Guardamos el archivo shapefile

shapefile_municipios &lt;- readOGR(&quot;Municipios_IGN.shp&quot;)
## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\Usuario\Desktop\r_que_r\r_que_r\content\datasets\Municipios_IGN\Municipios_IGN.shp&quot;, layer: &quot;Municipios_IGN&quot;
## with 8205 features
## It has 10 fields
## Integer64 fields read as strings:  OBJECTID

# Para convertir el archivo shapefile en un dataframe utilizamos la función tidy()

data_municipios &lt;- tidy(shapefile_municipios)

# primeras observaciones del dataset

head(data_municipios)
## # A tibble: 6 x 7
##    long   lat order hole  piece group id   
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 -1.58  42.4     1 FALSE 1     0.1   0    
## 2 -1.58  42.4     2 FALSE 1     0.1   0    
## 3 -1.58  42.4     3 FALSE 1     0.1   0    
## 4 -1.58  42.4     4 FALSE 1     0.1   0    
## 5 -1.58  42.4     5 FALSE 1     0.1   0    
## 6 -1.58  42.4     6 FALSE 1     0.1   0</code></pre>
<p><br />
</p>
<p>El código de los municipios se encuentra en el archivo original con el nombre CODIGOINE. Guardamos los códigos en un nuevo data frame llamado <code>codigo_municipios</code>. Al igual que hemos hecho anteriormente identificamos el “id” de cada municipio, que llamamos <code>codigo_municipios</code>, y, posteriormente, utilizando la función <code>left_join()</code> unimos los dos dataframes en uno llamado <code>data_municipios_mapa</code> que nos servirá para realizar el mapa final.<br />
</p>
<pre class="r"><code>
codigo_municipios &lt;- data.frame(shapefile_municipios$CODIGOINE)

head(codigo_municipios)
##   shapefile_municipios.CODIGOINE
## 1                          31164
## 2                          31165
## 3                          31166
## 4                          31167
## 5                          31168
## 6                          19306

codigo_municipios$id &lt;- as.character(seq(0, nrow(codigo_municipios)-1))

head(codigo_municipios)
##   shapefile_municipios.CODIGOINE id
## 1                          31164  0
## 2                          31165  1
## 3                          31166  2
## 4                          31167  3
## 5                          31168  4
## 6                          19306  5</code></pre>
<p><br />
</p>
<pre class="r"><code>
data_municipios_mapa &lt;- left_join(data_municipios, codigo_municipios, by = &quot;id&quot;) %&gt;%
  mutate(codigo_ine = as.character(`shapefile_municipios.CODIGOINE`)) %&gt;%
  select(-`shapefile_municipios.CODIGOINE`)

head(data_municipios_mapa)
## # A tibble: 6 x 8
##    long   lat order hole  piece group id    codigo_ine
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     
## 1 -1.58  42.4     1 FALSE 1     0.1   0     31164     
## 2 -1.58  42.4     2 FALSE 1     0.1   0     31164     
## 3 -1.58  42.4     3 FALSE 1     0.1   0     31164     
## 4 -1.58  42.4     4 FALSE 1     0.1   0     31164     
## 5 -1.58  42.4     5 FALSE 1     0.1   0     31164     
## 6 -1.58  42.4     6 FALSE 1     0.1   0     31164</code></pre>
<p><br />
</p>
</div>
<div id="mapa-de-los-municipios-usando-ggplot" class="section level2">
<h2>Mapa de los Municipios usando ggplot</h2>
<p>Una vez tenemos el dataframe con la información geográfica de los municipios españoles junto al código (CODIGOINE) y el “id” de cada uno de ellos <strong>procedemos a realizar el mapa correspondiente</strong> utilizando <code>ggplot2</code> de la misma forma que hemos hecho en los subapartados previos.</p>
<p><br />
</p>
<pre class="r"><code>
data_municipios_mapa %&gt;%
  ggplot() +
  geom_polygon(aes( x= long, y = lat, group = group),
               fill = &quot;violetred4&quot;,
               color = &quot;white&quot;,
               size = 0.05) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    panel.background = element_rect(colour= &quot;darkgrey&quot;, size= 0.5)) +
  ggtitle(&quot;Municipios Españoles&quot;)</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
</div>
</div>
<div id="mapa-del-porcentaje-de-riesgo-de-pobreza-por-comunidad-autónoma" class="section level1">
<h1>Mapa del porcentaje de Riesgo de Pobreza por Comunidad Autónoma</h1>
<p><br />
</p>
<p>A modo de ejemplo vamos a representar el <strong>porcentaje de Riesgo de Pobreza por Comunidad Autónoma</strong> en un mapa. Los <a href="https://www.ine.es/jaxiT3/Tabla.htm?t=9963&amp;L=0">datos</a>, referentes al año 2017, los obtenemos del Instituto Nacional de Estadística.</p>
<p><br />
</p>
<pre class="r"><code>
setwd(&quot;C:/Users/Usuario/Desktop/r_que_r/r_que_r/content/datasets&quot;)

library(readxl)

riesgo_pobreza &lt;- read_excel(&quot;riesgo_pobreza.xls&quot;)

head(riesgo_pobreza, n=20)
## # A tibble: 19 x 3
##       id Region                     Riesgo_pobreza
##    &lt;dbl&gt; &lt;chr&gt;                               &lt;dbl&gt;
##  1     0 Andalucía                            32  
##  2     1 Aragón                               14.2
##  3     2 Principado de Asturias               14  
##  4     3 Balears, Illes                       15.4
##  5     4 Canarias                             32.1
##  6     5 Cantabria                            19.9
##  7     6 Castilla y León                      16.1
##  8     7 Castilla - La Mancha                 29.9
##  9     8 Cataluña                             13.6
## 10     9 Comunitat Valenciana                 26  
## 11    10 Extremadura                          37.6
## 12    11 Galicia                              18.8
## 13    12 Comunidad de Madrid                  16.1
## 14    13 Región de Murcia                     28.6
## 15    14 Comunidad Foral de Navarra            8.9
## 16    15 País Vasco                            8.6
## 17    16 La Rioja                             16.6
## 18    17 Ceuta                                38.3
## 19    18 Melilla                              21.4</code></pre>
<p><br />
</p>
<p>Utilizamos la función <code>left_join()</code> para combinar el nuevo dataframe (<code>riesgo_pobreza</code>) con el que utilizamos previamente para realizar el mapa base (<code>data_ccaa_mapa</code>).</p>
<p><br />
</p>
<pre class="r"><code>
riesgo_pobreza$id &lt;- as.character(riesgo_pobreza$id)

riesgo_pobreza_grafico &lt;- data_ccaa_mapa %&gt;%
  left_join(riesgo_pobreza, by= &quot;id&quot;)

head(riesgo_pobreza_grafico)
## # A tibble: 6 x 10
##     long    lat order hole  piece group id    shapefile_ccaa.~ Region
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;            &lt;chr&gt; 
## 1 3.23e5 4.29e6     1 FALSE 1     0.1   0     AndalucÃ­a        Andal~
## 2 3.23e5 4.29e6     2 FALSE 1     0.1   0     AndalucÃ­a        Andal~
## 3 3.24e5 4.29e6     3 FALSE 1     0.1   0     AndalucÃ­a        Andal~
## 4 3.25e5 4.29e6     4 FALSE 1     0.1   0     AndalucÃ­a        Andal~
## 5 3.25e5 4.29e6     5 FALSE 1     0.1   0     AndalucÃ­a        Andal~
## 6 3.26e5 4.29e6     6 FALSE 1     0.1   0     AndalucÃ­a        Andal~
## # ... with 1 more variable: Riesgo_pobreza &lt;dbl&gt;</code></pre>
<p><br />
</p>
<p>Por último <strong>realizamos el gráfico</strong> utilizando <code>ggplot2</code> como hemos hecho previamente. Como ya se ha expuesto, podemos customizar nuestro grafico utilizando las funciones de dicho paquete. En el siguiente mapa realizamos algunas modificaciones (color de fondo, tamaño del texto del título, subtítulo, leyenda, cambio en la posición de la leyenda, etc.) sobre el mapa previo para ejemplificar la forma en la que podemos aplicar dichas modificaciones a nuestro gusto.</p>
<p><br />
</p>
<pre class="r"><code>
riesgo_pobreza_grafico %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill=Riesgo_pobreza), color= &quot;white&quot;, size = 0.2) +
  labs( title = &quot;Tasa de Riesgo de Pobreza por Comunidades Autónomas&quot;,
        subtitle = &quot;Unidades: Porcentaje&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;Tasa (%)&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.3),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;))</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>Como utilizamos valores continuos R utiliza un rango de colores azules para su representación gráfica. No obstante, nos puede interesar establecer <strong>grupos o categorías de valores</strong> para su representación. En este caso podemos calcular, por ejemplo, los quintiles de los nuestros valores y asignarles una categoría.</p>
<p><br />
</p>
<pre class="r"><code>
quantile(riesgo_pobreza_grafico$Riesgo_pobreza, probs = c(0.2, 0.4, 0.6, 0.8))
##  20%  40%  60%  80% 
## 14.2 16.1 18.8 32.0

# En función de los resultados obtenidos establecemos nuestros cortes en los siguientes valores:
corte &lt;- c(12, 18, 24, 30)


# Los valores mínimo y máximo son:

val_min &lt;- min(riesgo_pobreza_grafico$Riesgo_pobreza)
val_max &lt;- max(riesgo_pobreza_grafico$Riesgo_pobreza)


# Y por tanto, los rangos serán los siguientes:

breaks &lt;- c(val_min, corte, val_max)

riesgo_pobreza_grafico$breaks &lt;- cut(riesgo_pobreza_grafico$Riesgo_pobreza,
                                     breaks = breaks,
                                     include.lowest = T)

breaks_scale &lt;- levels(riesgo_pobreza_grafico$breaks)
labels_scale &lt;- rev(breaks_scale)</code></pre>
<p><br />
</p>
<p>Con respecto a los colores a utilizar podemos indicar los colores de nuestra elección, como ya hemos realizado en algún post anterior, o podemos hacer uso de alguna <strong>paleta de colores existente</strong>. Un ejemplo de posibles paletas se encuentra en el paquete <code>wesanderson</code>, las cuales se pueden visualizar <a href="https://github.com/karthik/wesanderson">aquí</a>. Para ello cargamos la librería y guardamos una de las paletas (Darjeeling1).</p>
<p><br />
</p>
<pre class="r"><code>
library(wesanderson)
## Warning: package &#39;wesanderson&#39; was built under R version 3.6.1

colores &lt;- wes_palette(&quot;Darjeeling1&quot;, 5, type = &quot;discrete&quot;)</code></pre>
<p><br />
</p>
<p>Por último <strong>realizamos el gráfico</strong> indicando los cortes (rangos) que nos interesan y los colores para cada una de las categorías de la siguiente manera:</p>
<p><br />
</p>
<pre class="r"><code>
riesgo_pobreza_grafico %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill=breaks), color= &quot;white&quot;, size = 0.2) +
  labs( title = &quot;Tasa de Riesgo de Pobreza por Comunidades Autónomas&quot;,
        subtitle = &quot;Unidades: Porcentaje&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;Tasa (%)&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.3),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;)) +
  scale_fill_manual(
    values = rev(colores),
    breaks = rev(breaks_scale))</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-19-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p> </p>
<p>En el último gráfico se visualiza claramente que las Comunidades Autónomas con menor tasa de riesgo de pobreza son el País Vasco y Navarra mientras que Extremadura, Andalucía y las Islas Canarias presentan los valores más elevados.</p>
<p><br />
</p>
</div>
<div id="mapa-de-la-tasa-de-mortalidad-por-provincia" class="section level1">
<h1>Mapa de la Tasa de Mortalidad por Provincia</h1>
<p><br />
</p>
<p>En esta ocasión vamos a representar en un mapa la <strong>tasa de mortalidad (defunciones por mil habitantes) por provincia</strong>. Los <a href="https://www.ine.es/FichasWeb/RegProvincias.do?fichas=4&amp;busc_comu=&amp;botonFichas=Ir+a+la+tabla+de+resultados">datos</a>, de nuevo, los obtenemos del Instituto Nacional de Estadística.</p>
<p><br />
</p>
<pre class="r"><code>
setwd(&quot;C:/Users/Usuario/Desktop/r_que_r/r_que_r/content/datasets&quot;)

tasa_mortalidad &lt;- read_excel(&quot;tasa_mortalidad.xls&quot;)

head(tasa_mortalidad) 
## # A tibble: 6 x 3
##      id Provincia    TM
##   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
## 1     0 Álava      8.46
## 2     1 Albacete   9.53
## 3     2 Alicante   8.81
## 4     3 Almería    7.78
## 5     4 Ávila     12.7 
## 6     5 Badajoz   10.3</code></pre>
<p><br />
</p>
<p>Utilizamos de nuevo la función <code>left_join()</code> para combinar el nuevo dataframe (<code>tasa_mortalidad</code>) con el que utilizamos previamente para realizar el mapa base (<code>data_provincias_mapa</code>).</p>
<p><br />
</p>
<pre class="r"><code>
tasa_mortalidad$id &lt;- as.character(tasa_mortalidad$id)

tasa_mortalidad_grafico &lt;- data_provincias_mapa %&gt;%
  left_join(tasa_mortalidad, by= &quot;id&quot;)

head(tasa_mortalidad_grafico)
## # A tibble: 6 x 10
##      long    lat order hole  piece group id    shapefile_provin~ Provincia    TM
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;             &lt;chr&gt;     &lt;dbl&gt;
## 1 497824. 4.78e6     1 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;     Álava      8.46
## 2 498457. 4.78e6     2 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;     Álava      8.46
## 3 498532. 4.78e6     3 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;     Álava      8.46
## 4 498382. 4.78e6     4 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;     Álava      8.46
## 5 498946. 4.78e6     5 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;     Álava      8.46
## 6 499046. 4.78e6     6 FALSE 1     0.1   0     &quot;Ã\u0081lava&quot;     Álava      8.46</code></pre>
<p><br />
</p>
<p>Por último <strong>realizamos el gráfico</strong> con <code>ggplot</code> usando el mismo theme que el utilizado en el mapa de las Comunidades Autónomas. Sin embargo, en esta ocasión, cambiamos la paleta de colores utilizando la función <code>scale_fill_gradient()</code> mediante la cual seleccionamos el color amarillo para los valores más bajos y el color rojo para los valores más altos.</p>
<p><br />
</p>
<pre class="r"><code>
tasa_mortalidad_grafico %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill= TM), color= &quot;white&quot;, size = 0.2) +
  labs( title = &quot;Tasa Bruta de Mortalidad por Provincia&quot;,
        subtitle = &quot;Defunciones por mil habitantes&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.3),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;)) +
  scale_fill_gradient(low = &quot;yellow&quot;, high = &quot;red&quot;)</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-22-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>Para establecer <strong>grupos o categorías de valores</strong> como la realizada para las Comunidades Autónomas realizaremos una operativa similar a la realizada previamente. En primer lugar identificaremos los cortes el valor mínimo y máximo del rango.</p>
<p><br />
</p>
<pre class="r"><code>
quantile(tasa_mortalidad_grafico$TM, probs = c(0.2, 0.4, 0.6, 0.8))
##   20%   40%   60%   80% 
##  8.07  9.13 10.26 11.70

# En función de los resultados obtenidos establecemos nuestros cortes en los siguientes valores:
corte &lt;- c(8, 9.5, 10.5, 12)


# Los valores mínimo y máximo son:

val_min &lt;- min(tasa_mortalidad_grafico$TM)
val_max &lt;- max(tasa_mortalidad_grafico$TM)


# Y por tanto, los rangos serán los siguientes:

breaks &lt;- c(val_min, corte, val_max)

tasa_mortalidad_grafico$breaks &lt;- cut(tasa_mortalidad_grafico$TM,
                                     breaks = breaks,
                                     include.lowest = T)

breaks_scale &lt;- levels(tasa_mortalidad_grafico$breaks)
labels_scale &lt;- rev(breaks_scale)</code></pre>
<p><br />
</p>
<p>Por último <strong>realizamos el gráfico</strong> indicando los cortes (rangos) establecidos y los colores para cada una de las categorías. En esta ocasión cargamos una nueva paleta (Moonrise3) de la misma librería usada en previamente.</p>
<p><br />
</p>
<pre class="r"><code>
colores &lt;- wes_palette(&quot;Moonrise3&quot;, 5, type = &quot;discrete&quot;)</code></pre>
<p><br />
</p>
<pre class="r"><code>
tasa_mortalidad_grafico %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill=breaks), color= &quot;white&quot;, size = 0.2) +
  labs( title = &quot;Tasa Bruta de Mortalidad por Provincia&quot;,
        subtitle = &quot;Defunciones por mil habitantes&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.3),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;)) +
  scale_fill_manual(
    values = rev(colores),
    breaks = rev(breaks_scale))</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-25-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
</div>
<div id="mapa-de-la-renta-media-por-persona-por-municipios-españoles" class="section level1">
<h1>Mapa de la Renta Media por Persona por Municipios Españoles</h1>
<p><br />
</p>
<p>Por último vamos a realizar un <strong>mapa a nivel de Municipios</strong> donde se exponga la Renta Media por Persona en el año 2016, según los <a href="https://www.ine.es/experimental/atlas/exp_atlas_tab.htm#">datos</a> obtenidos del INE.</p>
<p><br />
</p>
<p>En primer lugar, haciendo uso de los códigos de los municipios que se pueden consultar en el <a href="https://www.ine.es/daco/daco42/codmun/codmun10/10codmunmapa.htm">INE</a>, vamos a comprobar, de forma aleatoria, la existencia de algunos de ellos utilizando el dataset utilizado previamente (data_municipios_mapa) y los representaremos gráficamente:</p>
<p><br />
</p>
<pre class="r"><code>
data_municipios_mapa$codigo_ine &lt;- as.numeric(data_municipios_mapa$codigo_ine)


# Probando Abengibre (02001) en la Provincia de Albacete (2)

prueba &lt;- data_municipios_mapa %&gt;%
  filter(codigo_ine == 22001)

prueba %&gt;%
  ggplot() +
  geom_polygon(aes( x= long, y = lat, group = group),
               fill = &quot;blueviolet&quot;,
               color = &quot;white&quot;, 
               size = 0.1) +
  theme_minimal()</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-26-1.png" width="60%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>

# Probando Agost (03002) en la Provincia de Alicante (3)

prueba &lt;- data_municipios_mapa %&gt;%
  filter(codigo_ine == 03002)

prueba %&gt;%
  ggplot() +
  geom_polygon(aes( x= long, y = lat, group = group),
               fill = &quot;blueviolet&quot;,
               color = &quot;white&quot;, 
               size = 0.1) +
  theme_minimal()</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-26-2.png" width="60%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>

# Probando Allande (33001) en la Provincia de Asturias (33)

prueba &lt;- data_municipios_mapa %&gt;%
  filter(codigo_ine == 33001)

prueba %&gt;%
  ggplot() +
  geom_polygon(aes( x= long, y = lat, group = group),
               fill = &quot;blueviolet&quot;,
               color = &quot;white&quot;, 
               size = 0.1) +
  theme_minimal()</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-26-3.png" width="60%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>En segundo lugar cargamos el archivo donde se encuentra la información de la <strong>Renta Media</strong> (por persona) en cada Municipio.</p>
<p><br />
</p>
<pre class="r"><code>
setwd(&quot;C:/Users/Usuario/Desktop/r_que_r/r_que_r/content/datasets&quot;)

renta_media &lt;- read_excel(&quot;renta_media.xls&quot;)

head(renta_media)
## # A tibble: 6 x 3
##   Provincia Municipio       renta_media
##   &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;      
## 1 Albacete  02001 Abengibre 9690       
## 2 Albacete  02002 Alatoz    8008       
## 3 Albacete  02003 Albacete  10795      
## 4 Albacete  02004 Albatana  8082       
## 5 Albacete  02005 Alborea   7573       
## 6 Albacete  02006 Alcadozo  8100</code></pre>
<p><br />
</p>
<p>En el dataframe el nombre del código y del municipio aparecen en la misma columna (Municipio). Para <strong>separar ambos conceptos en dos columnas</strong> utilizamos la función <code>separate()</code>.</p>
<p><br />
</p>
<pre class="r"><code>
renta_media_separado &lt;- renta_media %&gt;%
  separate(Municipio, c(&quot;cod&quot;, &quot;municipio&quot;), 
           sep = &quot; &quot;, 
           extra = &quot;merge&quot;) 

head(renta_media_separado)
## # A tibble: 6 x 4
##   Provincia cod   municipio renta_media
##   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;      
## 1 Albacete  02001 Abengibre 9690       
## 2 Albacete  02002 Alatoz    8008       
## 3 Albacete  02003 Albacete  10795      
## 4 Albacete  02004 Albatana  8082       
## 5 Albacete  02005 Alborea   7573       
## 6 Albacete  02006 Alcadozo  8100


# Nombramos la columna codigo_ine 

renta_media_separado$codigo_ine &lt;- as.numeric(renta_media_separado$cod)

head(renta_media_separado)
## # A tibble: 6 x 5
##   Provincia cod   municipio renta_media codigo_ine
##   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;
## 1 Albacete  02001 Abengibre 9690              2001
## 2 Albacete  02002 Alatoz    8008              2002
## 3 Albacete  02003 Albacete  10795             2003
## 4 Albacete  02004 Albatana  8082              2004
## 5 Albacete  02005 Alborea   7573              2005
## 6 Albacete  02006 Alcadozo  8100              2006</code></pre>
<p><br />
</p>
<p><strong>Unimos los dos dataframes</strong> usando <code>left_join()</code>.</p>
<p><br />
</p>
<pre class="r"><code>
renta_media_grafico &lt;- data_municipios_mapa %&gt;%
  left_join(renta_media_separado, by = &quot;codigo_ine&quot;)</code></pre>
<p><br />
</p>
<p>Antes de realizar el mapa general vamos a visualizar previamente algunas provincias, también seleccionadas de forma aleatoria, con el objetivo de representar graficamente los distintos municipios de cada una de ellas atendiendo a su Renta Media. Aprovechamos este ejercicio para utilizar diferentes <strong>opciones para seleccionar colores</strong> a la hora de representar los municipios. Nótese que los municipios coloreados en gris son aquellos en los que el INE no provee información sobre la Renta Media.</p>
<p><br />
</p>
<pre class="r"><code>

# Provincia de Castellón

renta_media_grafico %&gt;%
  filter(Provincia ==&quot;Castellón&quot;) %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill= as.double(renta_media)), color= &quot;white&quot;, size = 0.1) +
  labs( title = &quot;Castellón&quot;,
        subtitle = &quot;Renta Media por Persona en 2016&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.3),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;)) </code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-30-1.png" width="60%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>

# Provincia de Gipuzkoa

renta_media_grafico %&gt;%
  filter(Provincia ==&quot;Guipozkoa&quot;) %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill= as.double(renta_media)), color= &quot;white&quot;, size = 0.1) +
  labs( title = &quot;Gipuzkoa&quot;,
        subtitle = &quot;Renta Media por Persona en 2016&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.3),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;)) +
  scale_fill_gradient(low = &quot;red&quot;, high = &quot;green&quot;)</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-30-2.png" width="60%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>

# Provincia de Zaragoza

renta_media_grafico %&gt;%
  filter(Provincia ==&quot;Zaragoza&quot;) %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill= as.double(renta_media)), color= &quot;white&quot;, size = 0.1) +
  labs( title = &quot;Zaragoza&quot;,
        subtitle = &quot;Renta Media por Persona en 2016&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.8),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;)) +
  scale_fill_gradientn(colours= terrain.colors(10))</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-30-3.png" width="60%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>

# Provincia de Valencia

renta_media_grafico %&gt;%
  filter(Provincia ==&quot;Valencia&quot;) %&gt;%
  ggplot(aes(x=long, y= lat, group = group)) +
  geom_polygon(aes(fill= as.double(renta_media)), color= &quot;white&quot;, size = 0.1) +
  labs( title = &quot;Valencia&quot;,
        subtitle = &quot;Renta Media por Persona en 2016&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_rect(fill = &quot;snow&quot;, color = NA),
    panel.background = element_rect(fill= &quot;snow&quot;, color = NA),
    plot.title = element_text(size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0),
    plot.caption = element_text(size = 8, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 8),
    legend.text = element_text(color = &quot;grey40&quot;, size = 7, hjust = 0),
    legend.position = c(0.93, 0.8),
    plot.margin = unit(c(0.5,2,0.5,1), &quot;cm&quot;))  +
  scale_fill_gradientn(colours= rainbow(4))</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-30-4.png" width="60%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>Para finalizar realizamos el <strong>mapa general</strong> donde representaremos el conjunto de Municipios Españoles según su Renta Media por persona. Sin entrar en detalle, siendo posible identificar diversas dinámicas, en términos generales el mapa refleja claramente la notable diferencia existente entre el norte y el sur del país en términos de Renta Media.</p>
<p><br />
</p>
<pre class="r"><code>
renta_media_grafico %&gt;%
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = as.numeric(renta_media)), 
               color = &quot;snow&quot;, 
               size = 0.001) +
  labs( title = &quot;Mapa de los Municipios Españoles&quot;,
        subtitle = &quot;Renta Media por Persona en 2016&quot;,
        caption = &quot;Fuente: INE&quot;,
        fill = &quot;Renta Media&quot;) +
  theme_minimal() +
  theme(
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.background = element_blank(),
    panel.background = element_blank(),
    plot.title = element_text(size = 14, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    plot.caption = element_text(size = 6, hjust = 1),
    legend.title = element_text(color = &quot;grey40&quot;, size = 7),
    legend.text = element_text(color = &quot;grey40&quot;, size = 5, hjust = 0),
    legend.position = c(0.93, 0.2)) +
  scale_fill_gradientn(colours= rainbow(5))</code></pre>
<p><img src="/mapas_spain_files/figure-html/unnamed-chunk-31-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
